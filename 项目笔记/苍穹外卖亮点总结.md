# 苍穹外卖亮点总结

### 1.登录：

使用jwt令牌拦截校验，使用md5加密对前端传过来的明文密码先加密再存数据库。返回令牌给前端，前端每一次请求都携带这个token。后端把token存到redis中进行校验，token中本身就携带用户信息，所以很方便可以知道该用户，并存到ThreadLocal中。

---

### 2.员工管理模块

#### 2.1新增员工亮点

使用ThreadLocal存储一次请求的id，轻松获取当前登录用户的id。

使用全局捕获异常，解决新增用户名字重复的问题。

#### 2.2员工分页查询

使用PageHelper工具类封装。

#### 2.3员工编辑

---

### 3.菜品管理模块

#### 3.1 公共字段填充

使用枚举+aop＋反射进行公共字段填充

实现:1.首先定义一个注解AutoFill,在mapper中添加了@AutoFill注解的方法都进行自动填充,并且这个注解的属性,和操作类型的枚举类Operatoin

​		2.定义一个AutoFillAspect切面类,在这个类中去定义切面方法.利用切点表达式使用注解指定切点,然后写@Before的方法autoFill(),通过反射机制获取entity实体对象的setter方法,实现自动填充.

#### 3.2 菜品增删改查，分页查询

没有什么亮点，注意涉及多个数据库表的连接，还有菜品口味表，mybatis设置返回主键id。

添加菜品中使用阿里云对象存储OSS服务，将上传的文件存储到阿里云服务器，并且将这个url返回给前端做图片的回显。

### 4.Redis缓存

没啥亮点，就使用redis缓存店铺状态数据。



### 5.微信小程序与HttpClint。

微信登录：首先小程序端调用wx.login获得一个授权码发送给tomcat服务器，tomcat再拿着这个授权码和appid和app密钥去请求微信服务器，利用HttpClint像微信服务器发送请求，获得一个微信用户的openid用户唯一标识，然后再返回用户信息给前端。如果该用户是第一次登录，则自动注册到数据库中，并且要连同jwt令牌一起返回给前端。同时还要添加用户端的拦截器进行请求的拦截。

### 6.缓存菜品

在小程序端中点击对应分类会弹出所有分类下的菜品，所以可以设置dish+分类id为key的缓存，减轻数据库的压力。如果缓存有数据直接返回，没有则查数据库并添加缓存，修改菜品和新增菜品时需要删除缓存，避免数据不一致的问题。**后期可以加入mq实现延迟双删**。

同时使用SpringCache进行缓存套餐，大大简化开发。![image-20240723185850105](C:\Users\86183\AppData\Roaming\Typora\typora-user-images\image-20240723185850105.png)

另外还进行了购物车模块增删改查的开发。

### 7.用户下单及微信支付

用户下单前先导入地址簿模块的功能代码。

用户下单业务逻辑并不复杂，点击支付后生成一个用户订单，插入订单详情表，并且清空购物车，返回订单VO给前端即可。

###### 微信支付--重点是读懂微信支付官方提供的api文档，微信支付的代码基本上是固定的以后有需要的时候则直接复制粘贴，我们主要要记住微信支付的流程时序图。



### 8.定时任务Spring Task

cron表达式---需要用的时候直接上网解析，有在线解析网站

导入maven，添加task任务类，定义cron表达式，编写定时任务的逻辑代码。

本项目用定时任务处理超时为支付的订单，and  每天凌晨一点处理已完成的订单数据。

### 9.WebSocket

###### websocket是一个用于在客户端和服务端进行全双工通信的协议，一次握手建立长连接，两个端都可以分别给对方发送数据。

使用websocket进行来单提醒功能：在用户支付成功后，调用webserver的api给前端发送jason数据，那么前端解析数据后可以进行语音播报和提醒。

使用websocket进行客户催单功能，一样是调用webserver的api给前端传递jackson。

### 10 数据统计

前端传递起始日期和结束日期，要求返回规定的数据。

1.营业额统计

2.用户统计

3.订单统计

4.销量前十统计

这类问题需要分析好接口返回什么数据，传递什么数据，查询数据库，编写好sql语句，之后进行数据封装，一步一步慢慢分析不会错的。



### 11 Excel报表

 1.POI入门：poi是一个java操作Excel的技术，提供APi让你可以读取Excel，写入Excel等操作。

本项目进行POI报表时只需遵循以下步骤：

![image-20240727202441007](C:\Users\86183\AppData\Roaming\Typora\typora-user-images\image-20240727202441007.png)

通过类加载器来加载静态资源Excel模板可以简化写操作。

至此，苍穹外卖结束，业务逻辑有些太过具体也记不住，但是并不复杂，也不简单，一步一步通过需求分析，设计好接口，根据接口文档来写总能解决的。
